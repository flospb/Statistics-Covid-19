# Приложение: Статистика Covid-19 #

Данное приложение является учебным и предназначено для получения актуальной статистики о заболеваемости Covid-19 по странам. 
Помимо этого, приложение содержит справочную информацию о симптомах болезни, рекомендациях противодействию распространения и полезные контакты. 
Так же приложение дает возможность загрузить из галереи изображение QR-кода, полученного при вакцинации и использовать его на пограничном контроле или других местах, требующих его наличие.

#### Содержание: ####  
[1. Описание работы приложения](#description)  
[2. Выполненные требования](#requirements)  
[3. Выбранная архитектура](#architecture)  
[4. Описание предназначения сервисов](#services)  
[5. Допущения, принятые в проекте и особенности технической реализации](#peculiarities)

<a name="description"><h2>Описание работы приложения</h2></a>
Приложение состоит из трех базовых экранов:
* Статистика по странам
* Вакцинация (фото QR кода и полезные контакты)
* Информация о симптомах и рекомендации

### Экран статистики ###
<img src="https://user-images.githubusercontent.com/73400440/133893518-4a7838df-76b1-40e2-8cc4-dedd01e96c2f.png" width="300" /><img src="https://user-images.githubusercontent.com/73400440/133893522-29431b1d-1476-4c98-b431-9a5fbae20c26.png" width="300" />

На данном экране отображается _статистика по стране_. По умолчанию, при первом запуске, подставляется страна «Россия».
Для выбора другой страны, необходимо нажать на элемент страны (флаг, название, картинка выбора), после чего откроется список стран.
После выбора страны отобразиться следующая статистика:
* Количество случаев заражения на текущую дату
* Количество случаев заражения на за предыдущий день
* Общее количество случаев взаимодействия с вирусом за все время, а так же количество с разбивкой по категориям (выздоровело, болеет и смертей)

Помимо статистики, доступно две команды:
* Обновить - запускается процесс загрузки последних доступных данных
* Поделиться - выполняется скриншот экрана с данными статистки, который доступен для 

### Экран вакцинации ###
<img src="https://user-images.githubusercontent.com/73400440/133893732-974627fe-eb10-458d-95e6-5f7721f9b985.png" width="300" /><img src="https://user-images.githubusercontent.com/73400440/133893749-f72d92b5-f418-4e8d-95bd-936922f6aca8.png" width="300" />

На данном экране отображается выбранное изображение (QR код) сертификата вакцинации и полезные контакты.

Для выбора изображения сертификата вакцинации из галереи необходимо нажать на область существующего изображения. 
В случае отсутствия изображения внутри данной области, будет отражена соответствующая надпись «Выбрать из галереи сертификат о вакцинации». 
Если необходимо очистить существующее изображение, можно воспользоваться одноименной командой «Очистить».

В качестве полезных контактов указан номер телефона Минздрава России, а так же ссылка на сайт Всемирной организации здравоохранения. 
При клике на область с рекомендациями ВОЗ будет открыт официальный сайт.

### Экран информации ###
<img src="https://user-images.githubusercontent.com/73400440/133893762-9f8d6597-b393-4f3c-8f52-aa1b202669be.png" width="300" /><img src="https://user-images.githubusercontent.com/73400440/133893765-27826208-ffad-49f9-9970-4987837b6684.png" width="300" />

На данном экране отображается информация о симптомах болезни, а так же рекомендации по противодействию распространения вируса.

<a name="requirements"><h2>Выполненные требования к проекту (с пояснениями)</h2></a>
>Использовать Core Data для хранения моделей данных  

В данном проекте Core data используется в качестве обеспечения оффлайн режима для случаев, когда данные из сети не могу быть загружены.
> Использовать KeyChain/UserDefaults для пользовательских настроек  

Для хранения выбранной страны используется UserDefaults.
> Использование Swift styleguides (Google styleguides)

При разрбаботке придерживался данным рекомендациям. _Важный нюанс_. Согласно требованиям Google, допустимая длина строки 100 символов. Файл swiftlint.yml от Сбера содержит ограничение в 120 символов. В связи с тем, что значения различаются, я допустил, что можно использовать свое значение. В связи с этим для более аккуратного отображениям увеличил данное значение до 140 символов.
> Не использовать сторонние библиотеки (кроме snapshot-тестов)

Из сторонних библиотек в проекте только две:
* Для snapshot-тестов использовал библиотеку SnapshotTesting
* Для проверки написания кода Swiftlint
> Использовать сеть

Из сети загружаются данные по статистике и картинки флагов стран.
> Отображение медиа (аудио, видео, изображения) из сети

В качестве медиа из сети загружаются картинки флагов стран.
> Минимальное количество экранов: 3

Экран статистики, вакцинации, информации. Так же экран списка стран и окно для отображения сайта ВОЗ.
> Обязательно использовать UINavigationController/TabBarController

Основная навигация - это TabBarController. При открытии списка стран и сайта ВОЗ используется UINavigationController.
> Deployment Target: iOS 13

Выполнено.
> Покрытие модульными тестами 10% и более

Процент покрытия = 13,3 %
> Хотя бы один UI-тест через page object

Выполнено
> Хотя бы один snapshot тест для iPhone SE (разрешается использовать внешнюю библиотеку)

Выполнено для SE, использовалась внешняя библиотека SnapshotTesting.
> Использование Архитектурных подходов и шаблонов проектирования

В качестве архитектуры каждого экрана используется MVC, а в целом для проекта используется SOA.
> Верстка UI в коде

Выполнено, верстка с помощью anchors. Только для LaunchScreen оставлен Storyboard.
> Обязательно использовать UITableView/UICollectionView

Для списка стран используется UITableView, а для отображения списка симптомов используется UICollectionView.
> Кастомные анимации

Экран статистики - анимация нажатия на View страны (флаг, название, картинка выбора). 
Экран вакцинации - анимация нажатия на View с областью выбора изображения из галереи, а так же на View с указанием ссылки на сайт ВОЗ.
Суть анимации - смена размера и цвета фона.
> Swiftlint

Выполнено, использован файл swiftlint.yml от Сберабанка.
> Системы аналитики и анализа крэшей  ( с использованием сторонних зависимостей )

Не выполнено.

<a name="architecture"><h2>Выбранная архитектура</h2></a>
В качестве архитектуры используется _SOA + MVC_. Приложение поделено на 4 слоя:
* Application layer - слой, который содержит в себе файлы, относящиеся к приложению в целом (AppDelegate, SceneDelegate и пр.).
* Presentation layer - слой презентации, где расположена реализация самих экранов с использованием MVC. Каждый экран, будь то экран статистики или вакцинации реализован с помощью MVC. Внутри файлы расположены по каталогам Model, View, Сontroller. Каталог View так же может содержать каталог Subviews, в котором расположены файлы дочерних View.
* Service layer - слой, в котором расположены все сервисы (Networking, CoreData и пр.).
* Core layer - слой, в котором расположены универсальные механизмы, но так же в разбивке по контексту использования.

_Важное примечание._
Когда происходит запуск приложения, сначала получаются и отображаются данные из хранилища (если они конечно есть), а после загрузки данных из сети - отображаются и параллельно отправляются на запись в базу данных. Ориентировался в этом вопросе на телеграм - когда нет сети, чаты все равно отображаются, просто с неактуальной информацией.

<a name="services"><h2>Описание предназначения сервисов</h2></a>
Сервисы:
* ImageActivityItemSource - сервис, который обеспечивает отображение скриншота экрана с маленьком квадратике (предпросмотр) меню поделиться
* AssemblyBuilder - главный сборщик приложения, пока в текущей реализации собирает контроллеры
* MainRouter - сервис, который управляет навигацией в приложении. Открытия или закрытие экранов происходит с его помощью
* NetworkingService - сервис работы с сетью, которые загружает данные по статистике и изображение флага страны. Для работы использует компонент с уровня Core «RequestSender», которые непосредственно отправляется в сеть и возвращается с данными. Данный компонент требует конфигурацию, которая в свою очередь содержит сам запрос (с нужным URL) и парсер, которые обрабатывает полученные данные из сети.
Для удобства и масштабирования создана фабрика запросов «RequestsFactory».
* CoreDataService - сервис работы с базой данных. Сохраняет и получает данные из базы.
* ImageStorageService - сервис, которые сохраняет изображение сертификата вакцинации в локальное хранилище на устройстве
* UserDefaultsService - сервис, которые используется для хранения выбранной страны. При открытии данные отображаются по последней выбранной стране.
* StatisticsDataMapper - сервис, который конвертирует данные из моделей базы данных в модели, которые используется в слое Presentation
* DataFormatterService - сервис, который используется для форматирования даты и строк.

<a name="peculiarities"><h2>Допущения, принятые в проекте и особенности технической реализации</h2></a>
Список допущений:
* Для хранения статической информации (текстовых названий, шрифтов, цветов) используется файл Constants. Возможно более правильно было разбить его на части, но так как проект небольшой, то все данные расположены в нем.
* Все названия протоколов начинаются с символа I
* Обработка ошибок при получении данных с использованием Core data сознательно не реализована, так как Core data является по сути оффлайн режимом
* Обработка ошибки загрузки изображения так же сознательно не обработана, так как в контексте приложения не является главным элементом работы. Возможно, правильнее такой случай обработать и формировать данные для сбора аналитики по ошибкам, но данная функциональность в приложении не реализовано.
* Главный источник истины данные из сети
* Экран со списком стран работает с входим массивом со странами. Возможно, было бы правильнее, чтобы данный список стран получался из Core data, но так как работа с базой затратная, плюс могут не спать записаться данные, выбран именно такой способ
* Сознательно не комментировал дополнительно код (кроме Mark), так как придерживаюсь правилу «Код должен сам говорить за себя» или «Код является плохим, если он как плохая шутка - его приходиться объяснять». Плюс, проект небольшой и не супер сложный, поэтому дополнительное комментирование излишне. А если непонятно, как работает - значит плохой неумен, а это уже другая история.


